import asyncio
import nest_asyncio
from telethon import TelegramClient, events
from datetime import datetime, timedelta

nest_asyncio.apply()

api_id = 29873749
api_hash = 'f747a66e89ef4b31e6ca7b7d06445091'
session_file = 'session.session'
client = TelegramClient(session_file, api_id, api_hash)

target_chat_id = -1002712861852
source_chat = '@TOPOVHELP'

keywords = [
    '411', '–¥–∞—á–∞ –ö–æ–≤–∞–ª–µ–≤—Å–∫–æ–≥–æ', '–ª—é—Å—Ç–¥–æ—Ä—Ñ—Å–∫–∞—è', '–º–∞—è–∫–∏', '–¥–≤–∞ —Å—Ç–æ–ª–±–∞', '2 —Å—Ç–æ–ª–±–∞',
    '–ì–ª—É—à–∫–æ', '–∞–∫–≤–∞—Ä–µ–ª—å 2', '2 –∞–∫–≤–∞—Ä–µ–ª—å', '–ø–µ—Ä–µ–ø—Ä–∞–≤–∞', '—á–µ—Ä–Ω–æ–º–æ—Ä–∫–∞', '–±–∞—Ä–∞–±–æ–π',
    '–º–∞–ª–æ–¥–æ–ª–∏–Ω—Å–∫–æ–µ', '–≤–µ–ª–∏–∫–æ–¥–æ–ª–∏–Ω—Å–∫–æ–µ', '–º–∞–ª–∞—è –¥–æ–ª–∏–Ω–∞', '–±–ø', '–±–ª–æ–∫–ø–æ—Å—Ç', '–±–ª–æ–∫-–ø–æ—Å—Ç',
    '–ª–µ–¥–µ–Ω—Ü–∏', '–ª–µ–¥–µ–Ω—Ü—ã', '–ª–µ–¥–µ–Ω–µ—Ü', '—Å—É—Ö–æ–π –ª–∏–º–∞–Ω', '–ø—Ä–∏–ª–∏–º–∞–Ω—Å–∫–æ–µ', '–Ω–æ–≤–∞—è –¥–æ–ª–∏–Ω–∞',
    '–¥–æ–±—Ä–æ–∞–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∫–∞', '–Ω–æ–≤–æ–≥–æ—Ä–æ–¥–∫–æ–≤–∫–∞', '–º–∞—Ä—å—è–Ω–æ–≤–∫–∞', '–π–æ—Å–∏–ø–æ–≤–∫–∞',
    '–ø–µ—Ç—Ä–æ–¥–æ–ª–∏–Ω—Å–∫–æ–µ', '–ø–µ—Ç—Ä–æ–¥–æ–ª–∏–Ω–∞', '–º–∏—Ä–Ω–æ–µ', '–≤–µ–ª–∏–∫–∏–π –¥–∞–ª—å–Ω–∏–∫', '–í–∏–ª—å—è–º—Å–∞',
    '—Ç–∞–∏—Ä–æ–≤–∞', '—Å–∏—Ç–∏—Ü–µ–Ω—Ç—Ä', '—Å–∏—Ç–∏ —Ü–µ–Ω—Ç—Ä', '–∫–æ—Ä–æ–ª–µ–≤–∞', '–∏–ª—å—Ñ–∞ –∏ –ø–µ—Ç—Ä–æ–≤–∞',
    '—Ñ–æ–Ω—Ç–∞–Ω', '—Ñ–∞–Ω—Ç–∞–Ω', '–≥–æ—Ä—å–∫–æ–≥–æ', '—Ç–∞–ª–±—É—Ö–∏–Ω–∞', '—Ç–æ–ª–±—É—Ö–∏–Ω–∞', '—Ç—Ü–∫'
]

async def main():
    print("üöÄ –ó–∞–ø—É—Å–∫ main()...")
    await client.start()
    print("üì° –ë–æ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ —Å–ª—É—à–∞–µ—Ç –∫–∞–Ω–∞–ª...")

    # --- –ß—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å ---
    async for message in client.iter_messages(source_chat, offset_date=datetime.now() - timedelta(hours=1)):
        if message.text and any(k in message.text.lower() for k in keywords):
            await client.send_message(target_chat_id, f'üîî –°—Ç–∞—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–∑–∞ —á–∞—Å):\n\n{message.text}')

    @client.on(events.NewMessage(chats=source_chat))
    async def handler(event):
        if event.message.message and any(k in event.message.message.lower() for k in keywords):
            await client.send_message(target_chat_id, f'üîî –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:\n\n{event.message.message}')

    await client.run_until_disconnected()

asyncio.run(main())
